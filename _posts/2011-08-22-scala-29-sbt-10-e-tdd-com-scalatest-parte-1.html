---
layout: post
title: Scala 2.9, sbt 1.0 e TDD com scalatest Parte 1
published: true
date: 2011-08-22
categories:
- scala
posterous_url: http://flmendes.posterous.com/scala-29-sbt-10-e-tdd-com-scalatest-parte-1
posterous_slug: scala-29-sbt-10-e-tdd-com-scalatest-parte-1
---
<p>Este é um pequeno post sobre Scala 2.9 e sbt 1.0 com scalatest, o sistema
operacional usado para criar esse post foi o Mac OS X, mas pode ser
facilmente migrado para Linux.</p>

<p>Para instalar o Scala em seu computador utilize o <a href="http://typesafe.com/stack/download">Typesafe Stack</a>. Simplifica bastante a configuração do
ambiente.</p>

<p>Existem várias formas de trabalhar com Scala, particularmente eu gosto do
sbt, por causa da sua semelhança com o maven.</p>

<p>Para instalar o sbt, crie uma pasta <strong>bin</strong> no seu diretório $HOME.</p>

<div class="CodeRay">
  <div class="code"><pre>mkdir  ~/bin</pre></div>
</div>


<p>Baixe o arquivo <a href="http://typesafe.artifactoryonline.com/typesafe/ivy-releases/org.scala-tools.sbt/sbt-launch/0.10.1/sbt-launch.jar">sbt-launch.jar</a>
e coloque no diretório bin que criamos acima.  Conforme recomendado evite
colocar o arquivo em um diretório mapeado no classpath.</p>

<p>No diretório <strong>bin</strong>, crie um arquivo chamado <strong>sbt</strong>.</p>

<div class="CodeRay">
  <div class="code"><pre>touch sbt</pre></div>
</div>


<p>Adicione as linhas ao arquivo <strong>sbt</strong></p>

<div class="CodeRay">
  <div class="code"><pre>java  -Dfile.encoding=UTF8 -Xmx1536M -Xss1M -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256m -jar `dirname $0`/sbt-launch.jar &quot;$@&quot;</pre></div>
</div>


<p>Salve o arquivo e modifique a permissão do arquivo.</p>

<div class="CodeRay">
  <div class="code"><pre>chmod  +x  ~/bin/sbt</pre></div>
</div>


<p>Ótimo, com o arquivo criado, agora vamos adicionar o diretório <strong>bin</strong> no
PATH do sistema.</p>

<p>Edite o arquivo <strong>.profile</strong> que está no raiz do diretório $HOME do seu
usuário.</p>

<div class="CodeRay">
  <div class="code"><pre>vim ~/.profile</pre></div>
</div>


<p>Adicione a seguinte linha ao arquivo e salve.</p>

<div class="CodeRay">
  <div class="code"><pre>export PATH=:$HOME/bin: $PATH</pre></div>
</div>


<p>Pronto, agora vamos criar o nosso primeiro projeto.</p>

<p>Crie um projeto chamado <strong>scala-fraction</strong>,  utilizando os comandos abaixo.</p>

<div class="CodeRay">
  <div class="code"><pre>mkdir  ~/scala-fraction
cd ~/scala-fraction
sbt</pre></div>
</div>


<p>Ok, se a sua configuração estiver correta o sbt irá definir o diretório
<strong>scala-fraction</strong> como sendo o raiz do seu projeto.</p>

<p>O resultado vai ser algo parecido com isso:</p>

<div class="CodeRay">
  <div class="code"><pre>[info] Set current project to default-210113 (in build file:/Users/flavio/scala-fraction/)
&gt;</pre></div>
</div>


<p>Sem sair do sbt digite os seguintes comandos:</p>

<div class="CodeRay">
  <div class="code"><pre>set name := “Scala Fraction”
set version := “1.0”
set scalaVersion := “2.9.0”
libraryDependencies += &quot;org.scalatest&quot; %% &quot;scalatest&quot; % &quot;1.6.1&quot;
session save
exit</pre></div>
</div>


<p>Quando você executa os comandos acima, o sbt cria e salva o arquivo
<strong>build.sbt</strong>, no raiz do diretório <strong>scala-fraction</strong>, nesse arquivo
definimos as informações básicas do projeto(name, version, scalaVersion) e
sua dependência(libraryDependencies).</p>

<p>O <strong>libraryDependencies</strong> utiliza a mesma nomeclatura de depêndencia do maven, sendo assim
temos:</p>

<blockquote class="posterous_short_quote"><p>libraryDependencies += groupID %% artifactID % revision</p></blockquote>

<p>No diretório do <strong>scala-fraction</strong>, crie o diretório <strong>src</strong> utilizando os
seguintes comandos.</p>

<div class="CodeRay">
  <div class="code"><pre>mkdir –p src/test/scala
mkdir –p src/main/scala</pre></div>
</div>


<p>O sbt utiliza uma estrutura semelhante ao maven, então com os comandos acima
criamos um diretório para test e um diretório para os arquivos dos projeto.</p>

<p>Crie um arquivo <strong>FractionSpec.scala</strong> no diretório <strong>src/test/scala</strong>.</p>

<div class="CodeRay">
  <div class="code"><pre>touch  src/test/scala/FractionSpec.scala</pre></div>
</div>


<p>Execute novamente o sbt e aguarde o sbt carregar a dependência do projeto.
Quando o sbt estiver carregado digite <strong>~test</strong>, com o este parâmetro o sbt
vai monitorar as alterações dos arquivos.</p>

<p>Vamos definir o nosso primeiro test e verificar o funcionamento do sbt.
Neste exemplo vamos trabalhar com frações e construir um simples programa
para somar e reduzir frações.</p>

<ol>
<li>Uma fração deve ter um numerador e um denominador;</li>
<li>Uma fração pode ser própria, impropria e unitária;</li>
<li>Uma fração pode ser reduzida;</li>
<li>Uma fração pode ser somada a outra fração.</li>
</ol>


<p>Para simplificar o exemplo a classe FractionSpec vai utilizar FlatSpec e
ShoudMatches, veja como vai fica a classe utilizando as especificações
acima.</p>

<p><script src="https://gist.github.com/1163014.js"></script></p>

<p>Note que no terminal o projeto foi compilado e foi executado o test acima.</p>

<div class="CodeRay">
  <div class="code"><pre>[info] FractionSpec:
[info] A fraction
[info] - should a numerator and denominator (pending)
[info] - should proper (pending)
[info] - should improper (pending)
[info] - should unit (pending)
[info] Passed: : Total 4, Failed 0, Errors 0, Passed 0, Skipped 4
[success] Total time: 3 s, completed Aug 22, 2011 1:28:33 PM
6. Waiting for source changes... (press enter to interrupt)</pre></div>
</div>


<p>Por enquanto é só&hellip;.</p>

<h2>Referências</h2>

<ul>
<li><a href="http://www.scalatest.org/">ScalaTest</a></li>
<li><a href="https://github.com/harrah/xsbt/wiki/Setup">Sbt Wiki</a></li>
<li><a href="http://typesafe.com/">Type Safe</a></li>
</ul>
